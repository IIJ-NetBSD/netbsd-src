#	$NetBSD: Makefile,v 1.8 2025/10/09 06:15:17 skrll Exp $

TARGETS+=	dtblist

.include <bsd.own.mk>

.if !empty(MACHINE_ARCH:Mearmv[567]*)
SUBDIR+=	arm
.endif

.if !empty(MACHINE_ARCH:Maarch64*)
SUBDIR+=	arm64
.endif

.if !empty(MACHINE_ARCH:Mriscv*)
SUBDIR+=	riscv
.endif

.include <bsd.subdir.mk>

# Regenerate MD set lists in distrib/sets/lists/dtb. Run this whenever
# new dts files are imported.

TARGET_ARCH_LIST=	earmv5
TARGET_ARCH_LIST+=	earmv6 earmv6hf earmv6eb earmv6hfeb
TARGET_ARCH_LIST+=	earmv7 earmv7hf earmv7hf earmv7hfeb
TARGET_ARCH_LIST+=	aarch64 aarch64eb
TARGET_ARCH_LIST+=	riscv32 riscv64

update-sets:
.for _arch in ${TARGET_ARCH_LIST}
	(echo '# $$''NetBSD''$$'; \
	 echo '#'; \
	 echo '# DO NOT EDIT THIS FILE MANUALLY'; \
	 echo '# Generated by "make update-sets" in sys/dtb'; \
	 echo '#'; \
	 ${MAKE} MACHINE_ARCH=${_arch} dtblist | grep '^[\.#]' | column -t | \
	    sort -u) > ${.CURDIR}/../../distrib/sets/lists/dtb/ad.${_arch}
.endfor
